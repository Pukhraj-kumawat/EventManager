{% extends 'home.html' %}

{% block content %}

<style>
    .event-info-div {
        border: 2px solid #000;
        padding: 10px;
    }

    .category-div {
        background-color: lightgray;
        display: inline-block;

    }

    .grid-div {
        display: grid;
        grid-template-columns: 1fr 1fr;

    }

    .filter-div-event {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
    }

    .filter-div-vendor {
        display: grid;
        grid-template-columns: 1fr 1fr;
    }

    .filter {
        border: 2px solid #000;
        padding: 10px;
    }
</style>

<h3>This is booking page </h3>



<div class="grid-div">

    {% if venues %}
    <div>
        <h1>Venues</h1>

        <div class="filter-div-event">

            <div class="filter">
                <form action="" method="GET">
                    <input type="text" placeholder="Search city" name="venue-city">
                </form>
                <a href="/book/{{pk}}/">All</a>


                {% for venue in venues %}
                {% if not min_price %}
                <a href="/book/{{pk}}/?venue-city={{venue.city}}" class="venue-{{venue.city}} venue-city">{{venue.city}}</a>       

                {% else %}
                <a href="/book/{{pk}}/?min_price={{min_price}}&max_price={{max_price}}&venue-city={{venue.city}}" class="venue-{{venue.city}} venue-city">{{venue.city}}</a>       
                {% endif %}
                {% endfor %}
                    


            </div>


            <div class="filter">
                <a href="/book/{{pk}}/">All</a>

                {% if not venue_city %}
                <div>
                    <a href="/book/{{pk}}/?min_price=0&max_price=9999" >Below Rs 10,000</a>
                    <a href="/book/{{pk}}/?min_price=10000&max_price=19999" >Rs 10,000 to Rs 20,000</a>
                    <a href="/book/{{pk}}/?min_price=20000&max_price=29999" >Rs 20,000 to Rs 30,000</a>
                    <a href="/book/{{pk}}/?min_price=30000&max_price=39999" >Rs 30,000 to Rs 40,000</a>
                    <a href="/book/{{pk}}/?min_price=40000&max_price=49999" >Rs 40,000 to Rs 50,000</a>
                    <a href="/book/{{pk}}/?min_price=50000&max_price=10000000000" >Above Rs 50,000</a>
                </div>
                {% else %}
                <a href="/book/{{pk}}/?min_price=0&max_price=9999&venue-city={{venue_city}}" >Below Rs 10,000</a>
                <a href="/book/{{pk}}/?min_price=10000&max_price=19999&venue-city={{venue_city}}" >Rs 10,000 to Rs 20,000</a>
                <a href="/book/{{pk}}/?min_price=20000&max_price=29999&venue-city={{venue_city}}" >Rs 20,000 to Rs 30,000</a>
                <a href="/book/{{pk}}/?min_price=30000&max_price=39999&venue-city={{venue_city}}" >Rs 30,000 to Rs 40,000</a>
                <a href="/book/{{pk}}/?min_price=40000&max_price=49999&venue-city={{venue_city}}" >Rs 40,000 to Rs 50,000</a>
                <a href="/book/{{pk}}/?min_price=50000&max_price=10000000000&venue-city={{venue_city}}" >Above Rs 50,000</a>
                {% endif %}

            </div>

        </div>

        {% if venues_on_price != 'unavailable' %}

        {% for venue in venues %}
        <div class="event-info-div">
            <a href="/venue-info/{{venue.id}}/">
                <h4>{{venue.name}}</h4>
            </a>
            <div>{{venue.location}}</div>
            <div>{{venue.city}} {{venue.state}}</div>
            <br>
            <div>Maximum capacity: {{venue.max_capacity}}</div>
            <div>Minimum price : {{venue.min_price}}</div>
            <h5>
                {% if venue.vendors.all %}
                <div> Book full packege (Venue + Vendor)<a href="/full-package/{{venue.id}}/">View</a></div>
                {% endif %}
            </h5>
            {% if request.user.is_authenticated %}

            {% if request.user.userprofile.user_type == 'is_customer' %}

            <form action="/create-book/" method="POST">
                {% csrf_token %}
                <input type="date" name="date" placeholder="date" required>
                <input type="time" name="time" placeholder="time">
                <input type="hidden" value="{{venue.id}}" name="venue_id">
                <button type="submit">Book now</button>

                {% endif %}

                {% else %}
                <button class="un-auth-book"><a href="/login-C/">Book now</a></button>
                {% endif %}

        </div>
        {% endfor %}

        {% else %}
            <p>Sorry! no Venue available for the given location with this price range.</p>
        {% endif %}
      
    </div>

    {% endif %}


        {% if events %}
    <div>
        <h1>Vendors</h1>

        <div class="filter-div-vendor">

            <div class="filter">
                <form action="" method="GET">
                    <input type="text" placeholder="Search city" name="vendor-city">
                </form>
                <a href="/book/{{pk}}/">All</a>
                {% for event in events %}
                <a href="/book/{{pk}}/?vendor-city={{event.event_planner.userprofile.city}}" class="vendor-{{event.event_planner.userprofile.city}} vendor-city">{{event.event_planner.userprofile.city}}
                </a>
                {% endfor %}
            </div>

        </div>


        {% for event in events %}

        <div class="event-info-div">


            <a href="/event-planner-info/{{event.event_planner.id}}/">
                <h4>{{event.event_planner.first_name}} {{event.event_planner.last_name}}</h4>
            </a>

            <div>
                <h5>{{event.name}}</h5>
            </div>
            <div>
                {{event.event_planner.userprofile.location}}
            </div>
            <div>
                {{event.event_planner.userprofile.city}} {{event.event_planner.userprofile.state}}
            </div>
            <br>
            <div>{{event.description}}</div>
            <br>

            {% if request.user.is_authenticated %}

            {% if request.user.userprofile.user_type == 'is_customer' %}

            <form action="/create-book/" method="POST">
                {% csrf_token %}
                <input type="date" name="date" placeholder="date" required>
                <input type="time" name="time" placeholder="time">
                <input type="hidden" value="{{event.event_planner.id}}" name="vendor_id">
                <button type="submit">Book now</button>

            </form>

            {% endif %}

            {% else %}
            <button class="un-auth-book"><a href="/login-C/">Book now</a></button>
            {% endif %}

        </div>
        {% endfor %}

    </div>
</div>

{% endif %}

<script>

uniqueVenueCity()
function uniqueVenueCity(){
let cityArray = [];
    document.querySelectorAll('.venue-city')
        .forEach((city)=>{
            cityArray.push(city.innerText);
            city.style.display = 'none'
        });
    cityArray.forEach((city)=>{
        document.querySelector(`.venue-${city}`)
            .style.display = 'inline';
    })
};


uniqueVendorCity()
function uniqueVendorCity(){
let cityArray = [];
    document.querySelectorAll('.vendor-city')
        .forEach((city)=>{
            cityArray.push(city.innerText);
            city.style.display = 'none'
        });
    
    cityArray.forEach((city)=>{
        document.querySelector(`.vendor-${city}`)
            .style.display = 'inline';
    })
};

    
    
</script>

{% endblock %}